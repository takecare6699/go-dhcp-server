# DHCP服务器管理系统

一个功能完整的DHCP服务器管理系统，提供Web界面进行可视化管理，支持网关健康检查、设备管理、配置热重载等高级功能。

## 🌟 主要特性

### 📊 核心功能
- **DHCP服务**: 完整的DHCP服务器功能，支持动态和静态IP分配
- **Web管理界面**: 现代化的Web界面，支持实时监控和管理
- **网关健康检查**: 自动监控网关状态，支持故障自动切换
- **设备管理**: 自动识别和管理网络设备
- **配置热重载**: 无需重启即可应用配置更改

### 🔧 高级功能
- **多网关支持**: 支持主备网关配置和自动切换
- **静态IP绑定**: 支持MAC地址到IP地址的静态绑定
- **DNS配置**: 支持网关专用DNS服务器配置
- **日志管理**: 完善的日志记录和查看功能
- **配置备份**: 自动备份和一键恢复配置
- **实时统计**: 详细的IP地址池和租约统计信息

### 🎨 界面特性
- **多主题支持**: 亮色、粉色、暗色三种主题
- **响应式设计**: 适配不同屏幕尺寸
- **实时更新**: 数据自动刷新，实时显示状态
- **用户友好**: 直观的操作界面和详细的使用说明

## 📋 系统要求

- **操作系统**: Linux、macOS、Windows
- **Go版本**: 1.19或更高版本
- **网络权限**: 需要绑定UDP 67端口（建议以管理员权限运行）
- **内存**: 最少64MB RAM
- **磁盘**: 最少100MB可用空间

## 🚀 快速开始

### 1. 编译程序
```bash
go build -o dhcp-server .
```

### 2. 运行服务器
```bash
# 以管理员权限运行（推荐）
sudo ./dhcp-server

# 使用自定义配置
sudo ./dhcp-server -config my-config.yaml

# 查看版本信息
./dhcp-server -version
```

### 3. 访问Web界面
服务启动后，访问 `http://localhost:8083` 进入Web管理界面。

## 📖 Web界面使用指南

### 📊 统计概览
页面顶部显示实时统计信息：
- **总IP数量**: 配置的IP地址池大小
- **活跃租约**: 当前正在使用的IP数量
- **静态租约**: 配置的静态IP绑定数量
- **地址池利用率**: IP地址使用百分比

### 📋 租约管理
管理DHCP IP地址租约的核心功能：
- **查看租约**: 显示活跃租约和历史租约
- **搜索过滤**: 按MAC地址或IP地址快速搜索
- **租约详情**: 查看租约时间、剩余时间、网关等信息
- **转换静态**: 将动态租约转换为静态IP绑定
- **租约状态**: 显示租约是否过期、是否静态绑定

### 📜 历史记录
查看DHCP服务的完整操作历史：
- **操作记录**: DISCOVER、REQUEST、RELEASE等DHCP操作
- **时间过滤**: 选择查看最近50/100/200/500条记录
- **设备跟踪**: 追踪特定设备的网络活动
- **故障排查**: 分析网络连接问题
- **网关信息**: 记录每个请求使用的网关

### 🌐 网关状态
监控和管理网络网关的健康状态：
- **健康监控**: 实时检查网关连通性
- **自动切换**: 网关故障时自动切换到备用网关
- **检测方式**: 支持ping、TCP、HTTP三种检测方法
- **网关管理**: 添加、编辑、删除网关配置
- **DNS配置**: 为每个网关配置专用的DNS服务器
- **状态显示**: 实时显示网关健康状态和响应时间

### 📱 设备管理
管理网络中的设备信息：
- **设备识别**: 自动识别设备类型和制造商
- **设备发现**: 扫描网络中的新设备
- **信息维护**: 编辑设备名称、类型、描述等信息
- **批量管理**: 支持批量添加和删除设备
- **静态IP配置**: 为设备配置静态IP地址绑定
- **设备状态**: 显示设备是否在线、最后活跃时间

### 🖥️ 服务器配置
配置DHCP服务器的基本参数：
- **网络接口**: 设置DHCP服务器监听的网络接口
- **DHCP端口**: 配置DHCP服务端口（默认67）
- **Web管理界面端口**: 设置Web界面的访问端口
- **Web管理界面访问地址**: 控制Web界面的访问权限
- **DHCP租期时间**: 设置IP地址的租用时间
- **日志配置**: 设置日志级别和日志文件
- **调试模式**: 启用详细的调试信息

### ⚙️ 配置管理
在线配置系统参数：
- **网络配置**: 设置IP地址池、DNS服务器、域名等
- **网关检测**: 配置健康检查参数
- **配置备份**: 自动备份和一键恢复配置
- **热重载**: 无需重启即可应用配置更改
- **配置验证**: 实时验证配置文件的语法正确性
- **配置文件编辑**: 在线编辑YAML配置文件

### 🎨 界面配置
个性化界面设置：
- **主题切换**: 亮色、粉色、暗色三种主题
- **自动刷新**: 设置数据自动刷新间隔
- **紧凑模式**: 在有限屏幕空间中显示更多信息
- **界面记忆**: 自动保存用户的界面偏好设置
- **高级功能显示**: 控制是否显示高级配置选项

### 📄 程序日志
查看和管理系统日志：
- **实时日志**: 查看最新的程序运行日志
- **日志过滤**: 按关键词搜索日志内容
- **自动刷新**: 实时更新日志内容
- **日志级别**: 显示不同级别的日志信息
- **日志下载**: 下载完整的日志文件

## 🔧 常见操作指南

### 📌 配置静态IP绑定
1. 在"设备管理"页面找到目标设备
2. 点击设备行末的"操作"按钮，选择"配置静态IP"
3. 设置绑定别名和IP地址
4. 选择指定网关（可选）
5. 设置主机名（可选）
6. 保存配置

**注意**: 静态IP必须在配置的地址池范围内，且不能与其他设备冲突。

### 🌐 添加网关
1. 进入"网关状态"页面
2. 点击"添加网关"按钮
3. 输入网关名称和IP地址
4. 设置是否为默认网关
5. 添加描述信息（可选）
6. 配置DNS服务器（可选）
7. 保存配置

**提示**: 系统会自动进行网关健康检查，确保网关可用性。

### 🔍 设备发现
1. 在"设备管理"页面点击"发现设备"
2. 系统会扫描当前租约中的新设备
3. 在弹出的对话框中选择要添加的设备
4. 可以批量选择多个设备
5. 确认添加到设备列表

**说明**: 设备发现基于当前DHCP租约记录，确保设备已连接到网络。

### 📁 配置备份与恢复
1. 进入"配置管理" → "配置文件管理"
2. **备份**: 点击"创建配置备份"自动生成备份文件
3. **恢复**: 从备份列表中选择要恢复的配置
4. 确认恢复操作
5. 系统会自动重载配置

**建议**: 修改重要配置前先创建备份，以便出现问题时快速恢复。

### 🖥️ 服务器配置修改
1. 进入"服务器配置"页面
2. 修改相关配置参数
3. 点击"保存服务器配置"
4. 系统会提示需要重启服务器
5. 确认重启以应用新配置

**注意**: 某些配置修改需要重启服务器才能生效。

### 🌐 网络配置调整
1. 进入"配置管理" → "网络配置"
2. 修改IP地址池范围
3. 调整DNS服务器配置
4. 设置租约时间参数
5. 点击"保存网络配置"
6. 系统会自动应用新配置

**提示**: 网络配置支持热重载，无需重启服务器。

## 🔧 故障排除

### ❌ 客户端无法获取IP地址
**可能原因和解决方案：**
- **检查网络接口**: 确认监听的网络接口配置正确
- **检查防火墙**: 确保UDP 67端口没有被阻止
- **检查地址池**: 查看IP地址池是否已满
- **查看日志**: 在"程序日志"页面查看详细错误信息
- **权限问题**: 确保以管理员权限运行程序
- **网络配置**: 检查子网掩码和网关配置是否正确

### 🚫 网关不可达
**诊断步骤：**
- **检查网关状态**: 在"网关状态"页面查看健康检查结果
- **手动测试**: 尝试手动ping网关IP地址
- **检查配置**: 确认网关IP地址配置正确
- **网络连通性**: 检查服务器到网关的网络连接
- **调整检测方式**: 尝试不同的健康检查方法（ping/tcp/http）
- **检查检测参数**: 调整检测间隔、超时时间和重试次数

### 🌐 Web界面无法访问
**排查步骤：**
- **检查端口**: 确认Web管理界面端口配置正确
- **检查访问地址**: 确认Web管理界面访问地址设置
- **防火墙设置**: 确保Web端口没有被防火墙阻止
- **服务状态**: 检查DHCP服务器是否正常运行
- **网络连接**: 确认客户端能够访问服务器IP地址

### ⚙️ 配置保存失败
**常见问题和解决方案：**
- **权限问题**: 确保程序有写入配置文件的权限
- **语法错误**: 检查YAML配置文件语法是否正确
- **磁盘空间**: 确认磁盘有足够的空间保存配置文件
- **文件锁定**: 检查配置文件是否被其他程序占用
- **配置验证**: 使用配置验证功能检查配置的正确性

### 📱 设备管理问题
**常见问题：**
- **设备未显示**: 检查设备是否已连接到网络并获取IP地址
- **设备信息不准确**: 手动编辑设备信息以更正识别结果
- **静态IP冲突**: 检查静态IP是否与其他设备冲突
- **设备发现失败**: 确认网络中有活跃的DHCP租约

## 🚀 高级功能

### 🔧 网关健康检查
系统支持多种网关健康检查方式：
- **PING检测**: 使用ICMP协议检测网关连通性
- **TCP检测**: 检测指定TCP端口的连通性
- **HTTP检测**: 发送HTTP请求检测网关响应
- **自动切换**: 主网关故障时自动切换到备用网关
- **状态监控**: 实时监控网关健康状态

### 📊 实时统计
系统提供详细的统计信息：
- **IP地址池统计**: 总IP数量、已用IP数量、利用率
- **租约统计**: 动态租约、静态租约、过期租约
- **网关统计**: 健康网关数量、故障网关数量
- **设备统计**: 在线设备数量、离线设备数量

### 🔄 热重载功能
支持配置热重载，无需重启服务：
- **网络配置**: 修改IP地址池、DNS等配置可立即生效
- **网关配置**: 添加、修改、删除网关配置
- **静态绑定**: 添加或删除静态IP绑定
- **设备配置**: 修改设备信息
- **健康检查配置**: 调整检测参数

### 📝 日志管理
完善的日志管理功能：
- **实时日志**: 实时查看程序运行日志
- **日志级别**: 支持debug、info、warn、error四个级别
- **日志文件**: 自动保存日志到文件
- **日志搜索**: 支持关键词搜索日志内容
- **日志过滤**: 按时间、级别过滤日志

## 📁 项目结构

```
go-dhcp-server/
├── api/           # HTTP API服务器
│   └── server.go  # Web界面和API实现
├── config/        # 配置管理
│   └── config.go  # 配置结构和验证
├── dhcp/          # DHCP核心功能
│   ├── server.go  # DHCP服务器实现
│   └── pool.go    # IP地址池管理
├── gateway/       # 网关健康检查
│   └── checker.go # 网关状态监控
├── main.go        # 程序入口
├── config.yaml    # 配置文件
└── README.md      # 项目说明
```

## 📄 配置文件示例

```yaml
server:
  interface: "en0"
  port: 67
  api_port: 8083
  api_host: "0.0.0.0"
  lease_time: "24h"
  log_level: "info"
  log_file: "dhcp.log"
  debug: false

network:
  subnet: "192.168.1.0/24"
  start_ip: "192.168.1.100"
  end_ip: "192.168.1.200"
  dns_servers: ["8.8.8.8", "8.8.4.4"]
  domain_name: "local"
  default_gateway: "192.168.1.1"

gateways:
  - name: "main_gateway"
    ip: "192.168.1.1"
    is_default: true
    description: "主网关"
    dns_servers: ["8.8.8.8", "8.8.4.4"]
  - name: "backup_gateway"
    ip: "192.168.1.2"
    is_default: false
    description: "备用网关"
    dns_servers: ["1.1.1.1", "1.0.0.1"]

bindings:
  - alias: "server1"
    mac: "00:11:22:33:44:55"
    ip: "192.168.1.101"
    gateway: "main_gateway"
    hostname: "server1.local"

devices:
  - mac: "00:11:22:33:44:55"
    device_type: "Server"
    model: "Dell PowerEdge"
    description: "主服务器"
    owner: "IT部门"

health_check:
  interval: "30s"
  timeout: "5s"
  retry_count: 3
  method: "ping"
```

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 📄 许可证

本项目采用MIT许可证。

## 💬 技术支持

如果您在使用过程中遇到问题，可以：
- **查看日志**: 在"程序日志"页面查看详细的错误信息
- **检查配置**: 使用配置验证功能检查配置文件的正确性
- **重启服务**: 尝试重启DHCP服务器
- **恢复备份**: 如果配置出现问题，可以恢复到之前的备份

**版本信息**: 当前版本 v1.0.0 